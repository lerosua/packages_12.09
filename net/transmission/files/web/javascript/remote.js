var RPC={_DaemonVersion:"version",_DownSpeedLimit:"speed-limit-down",_DownSpeedLimited:"speed-limit-down-enabled",_QueueMoveTop:"queue-move-top",_QueueMoveBottom:"queue-move-bottom",_QueueMoveUp:"queue-move-up",_QueueMoveDown:"queue-move-down",_Root:"../rpc",_TurtleDownSpeedLimit:"alt-speed-down",_TurtleState:"alt-speed-enabled",_TurtleUpSpeedLimit:"alt-speed-up",_UpSpeedLimit:"speed-limit-up",_UpSpeedLimited:"speed-limit-up-enabled"};function TransmissionRemote(a){this.initialize(a);return this}TransmissionRemote.prototype={initialize:function(a){this._controller=a;this._error="";this._token=""},ajaxError:function(d,f,c,a){var b,e=this;if(d.status===409&&(b=d.getResponseHeader("X-Transmission-Session-Id"))){e._token=b;$.ajax(a);return}e._error=d.responseText?d.responseText.trim().replace(/(<([^>]+)>)/ig,""):"";if(!e._error.length){e._error="服务器未响应"}dialog.confirm("连接已断开","无法连接到服务器，您可能需要重新载入页面重新连接。","详情","alert(remote._error);",null,"忽略");e._controller.togglePeriodicSessionRefresh(false)},appendSessionId:function(a){a.setRequestHeader("X-Transmission-Session-Id",this._token)},sendRequest:function(e,f,a,b){var d=this;if(typeof b!="boolean"){b=true}var c={url:RPC._Root,type:"POST",contentType:"json",dataType:"json",cache:false,data:JSON.stringify(e),beforeSend:function(g){d.appendSessionId(g)},error:function(h,i,g){d.ajaxError(h,i,g,c)},success:f,context:a,async:b};$.ajax(c)},loadDaemonPrefs:function(d,a,b){var c={method:"session-get"};this.sendRequest(c,d,a,b)},checkPort:function(d,a,b){var c={method:"port-test"};this.sendRequest(c,d,a,b)},loadDaemonStats:function(d,a,b){var c={method:"session-stats"};this.sendRequest(c,d,a,b)},updateTorrents:function(c,a,e,b){var d={method:"torrent-get","arguments":{fields:a}};if(c){d["arguments"].ids=c}this.sendRequest(d,function(f){var g=f["arguments"];e.call(b,g.torrents,g.removed)})},changeFileCommand:function(b,a,e){var d=this,c={ids:[b]};c[e]=a;this.sendRequest({arguments:c,method:"torrent-set"},function(){d._controller.refreshTorrents([b])})},sendTorrentSetRequests:function(f,b,a,e,c){if(!a){a={}}a.ids=b;var d={method:f,arguments:a};this.sendRequest(d,e,c)},sendTorrentActionRequests:function(d,a,c,b){this.sendTorrentSetRequests(d,a,null,c,b)},startTorrents:function(c,b,e,d){var a=b?"torrent-start-now":"torrent-start";this.sendTorrentActionRequests(a,c,e,d)},stopTorrents:function(a,c,b){this.sendTorrentActionRequests("torrent-stop",a,c,b)},moveTorrents:function(a,e,d,b){var c=this;this.sendTorrentSetRequests("torrent-set-location",a,{move:true,location:e},d,b)},removeTorrents:function(a,c,b){this.sendTorrentActionRequests("torrent-remove",a,c,b)},removeTorrentsAndData:function(c){var d=this;var e={method:"torrent-remove",arguments:{"delete-local-data":true,ids:[]}};if(c){for(var b=0,a=c.length;b<a;++b){e.arguments.ids.push(c[b].getId())}}this.sendRequest(e,function(){d._controller.refreshTorrents()})},verifyTorrents:function(a,c,b){this.sendTorrentActionRequests("torrent-verify",a,c,b)},reannounceTorrents:function(a,c,b){this.sendTorrentActionRequests("torrent-reannounce",a,c,b)},addTorrentByUrl:function(b,a){var c=this;if(b.match(/^[0-9a-f]{40}$/i)){b="magnet:?xt=urn:btih:"+b}var d={method:"torrent-add",arguments:{paused:(a.paused),filename:b}};this.sendRequest(d,function(){c._controller.refreshTorrents()})},savePrefs:function(a){var b=this;var c={method:"session-set",arguments:a};this.sendRequest(c,function(){b._controller.loadDaemonPrefs()})},updateBlocklist:function(){var a=this;var b={method:"blocklist-update"};this.sendRequest(b,function(){a._controller.loadDaemonPrefs()})},moveTorrentsToTop:function(a,c,b){this.sendTorrentActionRequests(RPC._QueueMoveTop,a,c,b)},moveTorrentsToBottom:function(a,c,b){this.sendTorrentActionRequests(RPC._QueueMoveBottom,a,c,b)},moveTorrentsUp:function(a,c,b){this.sendTorrentActionRequests(RPC._QueueMoveUp,a,c,b)},moveTorrentsDown:function(a,c,b){this.sendTorrentActionRequests(RPC._QueueMoveDown,a,c,b)}};