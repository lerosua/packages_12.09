function Torrent(a){this.initialize(a)}Torrent._StatusStopped=0;Torrent._StatusCheckWait=1;Torrent._StatusCheck=2;Torrent._StatusDownloadWait=3;Torrent._StatusDownload=4;Torrent._StatusSeedWait=5;Torrent._StatusSeed=6;Torrent._RatioUseGlobal=0;Torrent._RatioUseLocal=1;Torrent._RatioUnlimited=2;Torrent._ErrNone=0;Torrent._ErrTrackerWarning=1;Torrent._ErrTrackerError=2;Torrent._ErrLocalError=3;Torrent._TrackerInactive=0;Torrent._TrackerWaiting=1;Torrent._TrackerQueued=2;Torrent._TrackerActive=3;Torrent.Fields={};Torrent.Fields.Metadata=["addedDate","name","totalSize"];Torrent.Fields.Stats=["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"];Torrent.Fields.InfoExtra=["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"];Torrent.Fields.StatsExtra=["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"];Torrent.prototype={initialize:function(a){this.fields={};this.fieldObservers={};this.refresh(a)},notifyOnFieldChange:function(a,b){this.fieldObservers[a]=this.fieldObservers[a]||[];this.fieldObservers[a].push(b)},setField:function(e,b,d){var c,a;if(e[b]===d){return false}if(e==this.fields&&this.fieldObservers[b]&&this.fieldObservers[b].length){for(c=0;a=this.fieldObservers[b][c];++c){a.call(this,d,e[b],b)}}e[b]=d;return true},updateFiles:function(a){var e=false,c=this.fields.files||[],l=["length","name","bytesCompleted","wanted","priority"],g,h,d,k,b;for(g=0;h=a[g];++g){b=c[g]||{};for(d=0;k=l[d];++d){if(k in h){e|=this.setField(b,k,h[k])}}c[g]=b}this.fields.files=c;return e},collateTrackers:function(d){var c,b,a=[];for(c=0;b=d[c];++c){a.push(b.announce.toLowerCase())}return a.join("\t")},refreshFields:function(b){var a,c=false;for(a in b){switch(a){case"files":case"fileStats":c|=this.updateFiles(b[a]);break;case"trackerStats":c|=this.setField(this.fields,"trackers",b[a]);break;case"trackers":if(!(a in this.fields)){c|=this.setField(this.fields,a,b[a])}break;default:c|=this.setField(this.fields,a,b[a])}}return c},refresh:function(a){if(this.refreshFields(a)){$(this).trigger("dataChanged",this)}},getComment:function(){return this.fields.comment},getCreator:function(){return this.fields.creator},getDateAdded:function(){return this.fields.addedDate},getDateCreated:function(){return this.fields.dateCreated},getDesiredAvailable:function(){return this.fields.desiredAvailable},getDownloadDir:function(){return this.fields.downloadDir},getDownloadSpeed:function(){return this.fields.rateDownload},getDownloadedEver:function(){return this.fields.downloadedEver},getError:function(){return this.fields.error},getErrorString:function(){return this.fields.errorString},getETA:function(){return this.fields.eta},getFailedEver:function(a){return this.fields.corruptEver},getFile:function(a){return this.fields.files[a]},getFileCount:function(){return this.fields.files?this.fields.files.length:0},getHashString:function(){return this.fields.hashString},getHave:function(){return this.getHaveValid()+this.getHaveUnchecked()},getHaveUnchecked:function(){return this.fields.haveUnchecked},getHaveValid:function(){return this.fields.haveValid},getId:function(){return this.fields.id},getLastActivity:function(){return this.fields.activityDate},getLeftUntilDone:function(){return this.fields.leftUntilDone},getMetadataPercentComplete:function(){return this.fields.metadataPercentComplete},getName:function(){return this.fields.name||"Unknown"},getPeers:function(){return this.fields.peers},getPeersConnected:function(){return this.fields.peersConnected},getPeersGettingFromUs:function(){return this.fields.peersGettingFromUs},getPeersSendingToUs:function(){return this.fields.peersSendingToUs},getPieceCount:function(){return this.fields.pieceCount},getPieceSize:function(){return this.fields.pieceSize},getPrivateFlag:function(){return this.fields.isPrivate},getQueuePosition:function(){return this.fields.queuePosition},getRecheckProgress:function(){return this.fields.recheckProgress},getSeedRatioLimit:function(){return this.fields.seedRatioLimit},getSeedRatioMode:function(){return this.fields.seedRatioMode},getSizeWhenDone:function(){return this.fields.sizeWhenDone},getStartDate:function(){return this.fields.startDate},getStatus:function(){return this.fields.status},getTotalSize:function(){return this.fields.totalSize},getTrackers:function(){return this.fields.trackers},getUploadSpeed:function(){return this.fields.rateUpload},getUploadRatio:function(){return this.fields.uploadRatio},getUploadedEver:function(){return this.fields.uploadedEver},getWebseedsSendingToUs:function(){return this.fields.webseedsSendingToUs},isFinished:function(){return this.fields.isFinished},hasExtraInfo:function(){return"hashString" in this.fields},isSeeding:function(){return this.getStatus()===Torrent._StatusSeed},isStopped:function(){return this.getStatus()===Torrent._StatusStopped},isChecking:function(){return this.getStatus()===Torrent._StatusCheck},isDownloading:function(){return this.getStatus()===Torrent._StatusDownload},isDone:function(){return this.getLeftUntilDone()<1},needsMetaData:function(){return this.getMetadataPercentComplete()<1},getActivity:function(){return this.getDownloadSpeed()+this.getUploadSpeed()},getPercentDoneStr:function(){return Transmission.fmt.percentString(100*this.getPercentDone())},getPercentDone:function(){return this.fields.percentDone},getStateString:function(){switch(this.getStatus()){case Torrent._StatusStopped:return this.isFinished()?"完成做种":"暂停";case Torrent._StatusCheckWait:return"等待校验";case Torrent._StatusCheck:return"正在校验本地数据";case Torrent._StatusDownloadWait:return"等待下载";case Torrent._StatusDownload:return"下载中";case Torrent._StatusSeedWait:return"等待做种";case Torrent._StatusSeed:return"做种中";case null:case undefined:return"未知";default:return"错误"}},seedRatioLimit:function(a){switch(this.getSeedRatioMode()){case Torrent._RatioUseGlobal:return a.seedRatioLimit();case Torrent._RatioUseLocal:return this.getSeedRatioLimit();default:return -1}},getErrorMessage:function(){var a=this.getErrorString();switch(this.getError()){case Torrent._ErrTrackerWarning:return"服务器返回如下警告: "+a;case Torrent._ErrTrackerError:return"服务器返回如下错误: "+a;case Torrent._ErrLocalError:return"错误: "+a;default:return null}},getCollatedName:function(){var a=this.fields;if(!a.collatedName&&a.name){a.collatedName=a.name.toLowerCase()}return a.collatedName||""},getCollatedTrackers:function(){var a=this.fields;if(!a.collatedTrackers&&a.trackers){a.collatedTrackers=this.collateTrackers(a.trackers)}return a.collatedTrackers||""},testState:function(b){var a=this.getStatus();switch(b){case Prefs._FilterActive:return this.getPeersGettingFromUs()>0||this.getPeersSendingToUs()>0||this.getWebseedsSendingToUs()>0||this.isChecking();case Prefs._FilterSeeding:return(a===Torrent._StatusSeed)||(a===Torrent._StatusSeedWait);case Prefs._FilterDownloading:return(a===Torrent._StatusDownload)||(a===Torrent._StatusDownloadWait);case Prefs._FilterPaused:return this.isStopped();case Prefs._FilterFinished:return this.isFinished();default:return true}},test:function(d,a,c){var b=this.testState(d);if(b&&a&&a.length){b=this.getCollatedName().indexOf(a.toLowerCase())!==-1}if(b&&c&&c.length){b=this.getCollatedTrackers().indexOf(c)!==-1}return b}};Torrent.compareById=function(b,a){return b.getId()-a.getId()};Torrent.compareByName=function(b,a){return b.getCollatedName().localeCompare(a.getCollatedName())||Torrent.compareById(b,a)};Torrent.compareByQueue=function(b,a){return b.getQueuePosition()-a.getQueuePosition()};Torrent.compareByAge=function(f,e){var d=f.getDateAdded(),c=e.getDateAdded();return(c-d)||Torrent.compareByQueue(f,e)};Torrent.compareByState=function(f,e){var d=f.getStatus(),c=e.getStatus();return(c-d)||Torrent.compareByQueue(f,e)};Torrent.compareByActivity=function(f,e){var d=f.getActivity(),c=e.getActivity();return(c-d)||Torrent.compareByState(f,e)};Torrent.compareByRatio=function(f,e){var d=f.getUploadRatio(),c=e.getUploadRatio();if(d<c){return 1}if(d>c){return -1}return Torrent.compareByState(f,e)};Torrent.compareByProgress=function(f,e){var d=f.getPercentDone(),c=e.getPercentDone();return(d-c)||Torrent.compareByRatio(f,e)};Torrent.compareBySize=function(f,e){var d=f.getTotalSize(),c=e.getTotalSize();return(d-c)||Torrent.compareByName(f,e)};Torrent.compareTorrents=function(d,c,e,g){var f;switch(e){case Prefs._SortByActivity:f=Torrent.compareByActivity(d,c);break;case Prefs._SortByAge:f=Torrent.compareByAge(d,c);break;case Prefs._SortByQueue:f=Torrent.compareByQueue(d,c);break;case Prefs._SortByProgress:f=Torrent.compareByProgress(d,c);break;case Prefs._SortBySize:f=Torrent.compareBySize(d,c);break;case Prefs._SortByState:f=Torrent.compareByState(d,c);break;case Prefs._SortByRatio:f=Torrent.compareByRatio(d,c);break;default:f=Torrent.compareByName(d,c);break}if(g===Prefs._SortDescending){f=-f}return f};Torrent.sortTorrents=function(b,a,c){switch(a){case Prefs._SortByActivity:b.sort(this.compareByActivity);break;case Prefs._SortByAge:b.sort(this.compareByAge);break;case Prefs._SortByQueue:b.sort(this.compareByQueue);break;case Prefs._SortByProgress:b.sort(this.compareByProgress);break;case Prefs._SortBySize:b.sort(this.compareBySize);break;case Prefs._SortByState:b.sort(this.compareByState);break;case Prefs._SortByRatio:b.sort(this.compareByRatio);break;default:b.sort(this.compareByName);break}if(c===Prefs._SortDescending){b.reverse()}return b};