function Transmission(){this.initialize()}Transmission.prototype={initialize:function(){var b;this.remote=new TransmissionRemote(this);this.inspector=new Inspector(this,this.remote);this.prefsDialog=new PrefsDialog(this.remote);$(this.prefsDialog).bind("closed",$.proxy(this.onPrefsDialogClosed,this));this.isMenuEnabled=!isMobileDevice;this.filterText="";this._torrents={};this._rows=[];this.dirtyTorrents={};this.uriCache={};Prefs.getClutchPrefs(this);$(".numberinput").forceNumeric();$("#toolbar-pause").click($.proxy(this.stopSelectedClicked,this));$("#toolbar-start").click($.proxy(this.startSelectedClicked,this));$("#toolbar-pause-all").click($.proxy(this.stopAllClicked,this));$("#toolbar-start-all").click($.proxy(this.startAllClicked,this));$("#toolbar-remove").click($.proxy(this.removeClicked,this));$("#toolbar-open").click($.proxy(this.openTorrentClicked,this));$("#prefs-button").click($.proxy(this.togglePrefsDialogClicked,this));$("#upload_confirm_button").click($.proxy(this.confirmUploadClicked,this));$("#upload_cancel_button").click($.proxy(this.hideUploadDialog,this));$("#move_confirm_button").click($.proxy(this.confirmMoveClicked,this));$("#move_cancel_button").click($.proxy(this.hideMoveDialog,this));$("#turtle-button").click($.proxy(this.toggleTurtleClicked,this));$("#compact-button").click($.proxy(this.toggleCompactClicked,this));jQuery.event.props.push("dataTransfer");$("#torrent_upload_form").submit(function(){$("#upload_confirm_button").click();return false});$("#toolbar-inspector").click($.proxy(this.toggleInspector,this));b=$("#filter-mode");b.val(this[Prefs._FilterMode]);b.change($.proxy(this.onFilterModeClicked,this));$("#filter-tracker").change($.proxy(this.onFilterTrackerClicked,this));if(!isMobileDevice){$(document).bind("keydown",$.proxy(this.keyDown,this));$(document).bind("keyup",$.proxy(this.keyUp,this));$("#torrent_container").click($.proxy(this.deselectAll,this));$("#torrent_container").bind("dragover",$.proxy(this.dragenter,this));$("#torrent_container").bind("dragenter",$.proxy(this.dragenter,this));$("#torrent_container").bind("drop",$.proxy(this.drop,this));$("#inspector_link").click($.proxy(this.toggleInspector,this));this.setupSearchBox();this.createContextMenu()}if(this.isMenuEnabled){this.createSettingsMenu()}b={};b.torrent_list=$("#torrent_list")[0];b.toolbar_buttons=$("#toolbar ul li");b.toolbar_pause_button=$("#toolbar-pause")[0];b.toolbar_start_button=$("#toolbar-start")[0];b.toolbar_remove_button=$("#toolbar-remove")[0];this.elements=b;this.initializeSettings();var a=false;this.loadDaemonPrefs(a);this.loadDaemonStats(a);this.initializeTorrents();this.refreshTorrents();this.togglePeriodicSessionRefresh(true);this.updateButtonsSoon()},loadDaemonPrefs:function(a){this.remote.loadDaemonPrefs(function(b){var c=b["arguments"];Prefs.getClutchPrefs(c);this.updateGuiFromSession(c);this.sessionProperties=c},this,a)},loadImages:function(){for(var a=0,b;b=arguments[a];++a){jQuery("<img>").attr("src",b)}},initializeSettings:function(){Prefs.getClutchPrefs(this);if(this.isMenuEnabled){$("#sort_by_"+this[Prefs._SortMethod]).selectMenuItem();if(this[Prefs._SortDirection]===Prefs._SortDescending){$("#reverse_sort_order").selectMenuItem()}}this.initCompactMode()},setupSearchBox:function(){var a=this;var b=$("#torrent_search");b.bind("keyup click",function(){a.setFilterText(this.value)});if(!$.browser.safari){b.addClass("blur");b[0].value="Filter";b.bind("blur",function(){if(this.value===""){$(this).addClass("blur");this.value="Filter";a.setFilterText(null)}}).bind("focus",function(){if($(this).is(".blur")){this.value="";$(this).removeClass("blur")}})}},createContextMenu:function(){var a=this;var b={context_pause_selected:function(){a.stopSelectedTorrents()},context_resume_selected:function(){a.startSelectedTorrents(false)},context_resume_now_selected:function(){a.startSelectedTorrents(true)},context_move:function(){a.moveSelectedTorrents(false)},context_remove:function(){a.removeSelectedTorrents()},context_removedata:function(){a.removeSelectedTorrentsAndData()},context_verify:function(){a.verifySelectedTorrents()},context_reannounce:function(){a.reannounceSelectedTorrents()},context_move_top:function(){a.moveTop()},context_move_up:function(){a.moveUp()},context_move_down:function(){a.moveDown()},context_move_bottom:function(){a.moveBottom()},context_select_all:function(){a.selectAll()},context_deselect_all:function(){a.deselectAll()}};$("ul#torrent_list").contextMenu("torrent_context_menu",{bindings:b,menuStyle:{width:"310px",backgroundColor:"#fff",border:"none",padding:"5px 0",textAlign:"left"},itemStyle:{backgroundColor:"transparent",margin:"0",padding:"3px 10px 3px 20px",color:"#000",cursor:"default",border:"none"},itemHoverStyle:{backgroundColor:"#24e",color:"#fff",border:"none"},shadow:false,boundingElement:$("div#torrent_container"),boundingRightPad:20,boundingBottomPad:5,onContextMenu:function(e){var d=$(e.target).closest(".torrent")[0];var c=$("#torrent_list > li").index(d);if((c!==-1)&&!a._rows[c].isSelected()){a.setSelectedRow(a._rows[c])}return true}})},createSettingsMenu:function(){$("#settings_menu").transMenu({selected_char:"&#x2714;",direction:"up",onClick:$.proxy(this.onMenuClicked,this)});$("#unlimited_download_rate").selectMenuItem();$("#unlimited_upload_rate").selectMenuItem()},getAllTorrents:function(){var b=[];for(var a in this._torrents){b.push(this._torrents[a])}return b},getTorrentIds:function(a){return $.map(a.slice(0),function(b){return b.getId()})},scrollToRow:function(f){if(isMobileDevice){return}var c=$("#torrent_container"),e=c.scrollTop(),d=c.innerHeight(),b=f.getElement().offsetTop,a=$(f.getElement()).outerHeight();if(b<e){c.scrollTop(b)}else{if(d+e<b+a){c.scrollTop(b+a-d)}}},seedRatioLimit:function(){var a=this.sessionProperties;if(a&&a.seedRatioLimited){return a.seedRatioLimit}return -1},setPref:function(a,b){this[a]=b;Prefs.setValue(a,b)},getSelectedRows:function(){return $.grep(this._rows,function(a){return a.isSelected()})},getSelectedTorrents:function(){return $.map(this.getSelectedRows(),function(a){return a.getTorrent()})},getSelectedTorrentIds:function(){return this.getTorrentIds(this.getSelectedTorrents())},setSelectedRow:function(a){$(this.elements.torrent_list).children(".selected").removeClass("selected");this.selectRow(a)},selectRow:function(a){$(a.getElement()).addClass("selected");this.callSelectionChangedSoon()},deselectRow:function(a){$(a.getElement()).removeClass("selected");this.callSelectionChangedSoon()},selectAll:function(){$(this.elements.torrent_list).children().addClass("selected");this.callSelectionChangedSoon()},deselectAll:function(){$(this.elements.torrent_list).children(".selected").removeClass("selected");this.callSelectionChangedSoon();delete this._last_torrent_clicked},indexOfLastTorrent:function(){for(var a=0,b;b=this._rows[a];++a){if(b.getTorrentId()===this._last_torrent_clicked){return a}}return -1},selectRange:function(f){var e=this.indexOfLastTorrent();if(e===-1){this.selectRow(f)}else{var d=this._rows.indexOf(f);var c=Math.min(e,d);var a=Math.max(e,d);for(var b=c;b<=a;++b){this.selectRow(this._rows[b])}}this.callSelectionChangedSoon()},selectionChanged:function(){this.updateButtonStates();this.inspector.setTorrents(this.inspectorIsVisible()?this.getSelectedTorrents():[]);clearTimeout(this.selectionChangedTimer);delete this.selectionChangedTimer},callSelectionChangedSoon:function(){if(!this.selectionChangedTimer){var b=$.proxy(this.selectionChanged,this),a=200;this.selectionChangedTimer=setTimeout(b,a)}},keyDown:function(k){var h=false,m=this._rows,g=k.keyCode===38,f=k.keyCode===40,b=k.keyCode===16;if((g||f)&&m.length){var l=this.indexOfLastTorrent(),e=l,d=this._shift_index,a,c=0,j=m.length-1;if(f&&(e+1<=j)){++e}else{if(g&&(e-1>=c)){--e}}var a=m[e];if(d>=0){if(((d<=l)&&(l<e))||((d>=l)&&(l>e))){this.selectRow(a)}else{if(((d>=l)&&(e>l))||((d<=l)&&(l>e))){this.deselectRow(m[l])}}}else{if(k.shiftKey){this.selectRange(a)}else{this.setSelectedRow(a)}}this._last_torrent_clicked=a.getTorrentId();this.scrollToRow(a);h=true}else{if(b){this._shift_index=this.indexOfLastTorrent()}}return !h},keyUp:function(a){if(a.keyCode===16){delete this._shift_index}},isButtonEnabled:function(a){var b=(a.target||a.srcElement).parentNode;return b.className!=="disabled"&&b.parentNode.className!=="disabled"},stopSelectedClicked:function(a){if(this.isButtonEnabled(a)){this.stopSelectedTorrents();this.hideMobileAddressbar()}},startSelectedClicked:function(a){if(this.isButtonEnabled(a)){this.startSelectedTorrents(false);this.hideMobileAddressbar()}},stopAllClicked:function(a){if(this.isButtonEnabled(a)){this.stopAllTorrents();this.hideMobileAddressbar()}},startAllClicked:function(a){if(this.isButtonEnabled(a)){this.startAllTorrents(false);this.hideMobileAddressbar()}},openTorrentClicked:function(a){if(this.isButtonEnabled(a)){$("body").addClass("open_showing");this.uploadTorrentFile();this.updateButtonStates()}},dragenter:function(c){if(c.dataTransfer&&c.dataTransfer.types){var b=["text/uri-list","text/plain"];for(var a=0;a<b.length;++a){if(c.dataTransfer.types.contains(b[a])){c.stopPropagation();c.preventDefault();c.dropEffect="copy";return false}}}else{if(c.dataTransfer){c.dataTransfer.dropEffect="none"}}return true},drop:function(f){var d,e,a=null,c=["text/uri-list","text/plain"],b=this.shouldAddedTorrentsStart();if(!f.dataTransfer||!f.dataTransfer.types){return true}for(d=0;!a&&d<c.length;++d){if(f.dataTransfer.types.contains(c[d])){a=f.dataTransfer.getData(c[d]).split("\n")}}for(d=0;e=a[d];++d){if(/^#/.test(e)){continue}if(/^[a-z-]+:/i.test(e)){this.remote.addTorrentByUrl(e,b)}}f.preventDefault();return false},hideUploadDialog:function(){$("body.open_showing").removeClass("open_showing");$("#upload_container").hide();this.updateButtonStates()},confirmUploadClicked:function(){this.uploadTorrentFile(true);this.hideUploadDialog()},hideMoveDialog:function(){$("#move_container").hide();this.updateButtonStates()},confirmMoveClicked:function(){this.moveSelectedTorrents(true);this.hideUploadDialog()},removeClicked:function(a){if(this.isButtonEnabled(a)){this.removeSelectedTorrents();this.hideMobileAddressbar()}},togglePeriodicSessionRefresh:function(a){clearInterval(this.sessionInterval);delete this.sessionInterval;if(a){var c=$.proxy(this.loadDaemonPrefs,this),b=8000;this.sessionInterval=setInterval(c,b)}},toggleTurtleClicked:function(){var a={};a[RPC._TurtleState]=!$("#turtle-button").hasClass("selected");this.remote.savePrefs(a)},onPrefsDialogClosed:function(){$("#prefs-button").removeClass("selected")},togglePrefsDialogClicked:function(a){var b=$("#prefs-button");if(b.hasClass("selected")){this.prefsDialog.close()}else{b.addClass("selected");this.prefsDialog.show()}},setFilterText:function(a){this.filterText=a?a.trim():null;this.refilter(true)},setSortMethod:function(a){this.setPref(Prefs._SortMethod,a);this.refilter(true)},setSortDirection:function(a){this.setPref(Prefs._SortDirection,a);this.refilter(true)},onMenuClicked:function(c){var e,a,f=c.target.id,d=this.remote,b=$(c.target);if(b.hasClass("sort-mode")){b.parent().find(".sort-mode").each(function(){b.parent().deselectMenuItem()});b.selectMenuItem();this.setSortMethod(f.replace(/sort_by_/,""))}else{if(b.hasClass("upload-speed")){e={};e[RPC._UpSpeedLimit]=parseInt(c.target.innerHTML);e[RPC._UpSpeedLimited]=true;d.savePrefs(e)}else{if(b.hasClass("download-speed")){e={};e[RPC._DownSpeedLimit]=parseInt(c.target.innerHTML);e[RPC._DownSpeedLimited]=true;d.savePrefs(e)}else{switch(f){case"statistics":this.showStatsDialog();break;case"about-button":e="Transmission "+this.serverVersion;$("#about-dialog #about-title").html(e);$("#about-dialog").dialog({title:"关于",show:"fade",hide:"fade"});break;case"homepage":window.open("http://www.transmissionbt.com/");break;case"tipjar":window.open("http://rsis.me");break;case"unlimited_download_rate":e={};e[RPC._DownSpeedLimited]=false;d.savePrefs(e);break;case"limited_download_rate":e={};e[RPC._DownSpeedLimited]=true;d.savePrefs(e);break;case"unlimited_upload_rate":e={};e[RPC._UpSpeedLimited]=false;d.savePrefs(e);break;case"limited_upload_rate":e={};e[RPC._UpSpeedLimited]=true;d.savePrefs(e);break;case"reverse_sort_order":if(b.menuItemIsSelected()){a=Prefs._SortAscending;b.deselectMenuItem()}else{a=Prefs._SortDescending;b.selectMenuItem()}this.setSortDirection(a);break;case"toggle_notifications":Notifications&&Notifications.toggle();break;default:console.log("unhandled: "+f);break}}}}$("#settings_menu").trigger("closemenu");c.stopImmediatePropagation()},onTorrentChanged:function(b,a){this.dirtyTorrents[a.getId()]=true;this.refilterSoon();this.updateButtonsSoon()},updateFromTorrentGet:function(g,c){var d,b,k,a,h,f=[],j,e;for(d=0;b=g[d];++d){a=b.id;if((k=this._torrents[a])){h=k.needsMetaData();k.refresh(b);if(h&&!k.needsMetaData()){f.push(a)}}else{k=this._torrents[a]=new Torrent(b);this.dirtyTorrents[a]=true;j=$.proxy(this.onTorrentChanged,this);$(k).bind("dataChanged",j);if(!("name" in k.fields)||!("status" in k.fields)){f.push(a)}k.notifyOnFieldChange("status",$.proxy(function(l,i){if(i===Torrent._StatusDownload&&(l==Torrent._StatusSeed||l==Torrent._StatusSeedWait)){$(this).trigger("downloadComplete",[k])}else{if(i===Torrent._StatusSeed&&l===Torrent._StatusStopped&&k.isFinished()){$(this).trigger("seedingComplete",[k])}else{$(this).trigger("statusChange",[k])}}},this))}}if(f.length){e=["id"].concat(Torrent.Fields.Metadata,Torrent.Fields.Stats);this.updateTorrents(f,e);this.refilterSoon()}if(c){this.deleteTorrents(c);this.refilterSoon()}},updateTorrents:function(b,a){this.remote.updateTorrents(b,a,this.updateFromTorrentGet,this)},refreshTorrents:function(){var c=$.proxy(this.refreshTorrents,this),b=this[Prefs._RefreshRate]*1000,a=["id"].concat(Torrent.Fields.Stats);this.updateTorrents("recently-active",a);clearTimeout(this.refreshTorrentsTimeout);this.refreshTorrentsTimeout=setTimeout(c,b)},initializeTorrents:function(){var a=["id"].concat(Torrent.Fields.Metadata,Torrent.Fields.Stats);this.updateTorrents(null,a)},onRowClicked:function(b){var a=b.metaKey||b.ctrlKey,c=b.currentTarget.row;if(b.target.className==="torrent_resume"){this.startTorrent(c.getTorrent());return}if(b.target.className==="torrent_pause"){this.stopTorrent(c.getTorrent());return}b.stopPropagation();$("#jqContextMenu").hide();if(isMobileDevice){if(c.isSelected()){this.setInspectorVisible(true)}this.setSelectedRow(c)}else{if(b.shiftKey){this.selectRange(c);window.focus()}else{if(!c.isSelected()&&a){this.selectRow(c)}else{if(!c.isSelected()){this.setSelectedRow(c)}else{if(c.isSelected()&&a){this.deselectRow(c)}else{if(c.isSelected()){this.setSelectedRow(c)}}}}}}this._last_torrent_clicked=c.getTorrentId()},deleteTorrents:function(b){var a,c;if(b&&b.length){for(a=0;c=b[a];++a){this.dirtyTorrents[c]=true;delete this._torrents[c]}this.refilter()}},shouldAddedTorrentsStart:function(){return this.prefsDialog.shouldAddedTorrentsStart()},uploadTorrentFile:function(d){if(!d){$("input#torrent_upload_file").attr("value","");$("input#torrent_upload_url").attr("value","");$("input#torrent_auto_start").attr("checked",this.shouldAddedTorrentsStart());$("#upload_container").show();$("#torrent_upload_url").focus()}else{var a={};var c=this.remote;var b=!$("#torrent_auto_start").is(":checked");if(""!=$("#torrent_upload_url").val()){c.addTorrentByUrl($("#torrent_upload_url").val(),{paused:b})}else{a.url="../upload?paused="+b;a.type="POST";a.data={"X-Transmission-Session-Id":c._token};a.dataType="xml";a.iframe=true;$("#torrent_upload_form").ajaxSubmit(a)}}},promptSetLocation:function(d,b){if(!d){var c;if(b.length===1){c=b[0].getDownloadDir()}else{c=$("#download-dir").val()}$("input#torrent_path").attr("value",c);$("#move_container").show();$("#torrent_path").focus()}else{var a=this.getTorrentIds(b);this.remote.moveTorrents(a,$("input#torrent_path").val(),this.refreshTorrents,this);$("#move_container").hide()}},moveSelectedTorrents:function(b){var a=this.getSelectedTorrents();if(a.length){this.promptSetLocation(b,a)}},removeSelectedTorrents:function(){var a=this.getSelectedTorrents();if(a.length){this.promptToRemoveTorrents(a)}},removeSelectedTorrentsAndData:function(){var a=this.getSelectedTorrents();if(a.length){this.promptToRemoveTorrentsAndData(a)}},promptToRemoveTorrents:function(b){if(b.length===1){var c=b[0],d="删除 "+c.getName()+"?",a="一旦删除，继续传输将需要种子文件。是否删除所选种子？";dialog.confirm(d,a,"删除","transmission.removeTorrents",b)}else{var d="删除所选的 "+b.length+" 个种子？",a="一旦删除，继续传输将需要种子文件。是否删除所选种子？";dialog.confirm(d,a,"删除","transmission.removeTorrents",b)}},promptToRemoveTorrentsAndData:function(b){if(b.length===1){var c=b[0],d="删除种子 "+c.getName()+" 和下载的数据？",a="这个种子下载的所有数据将被删除，你确定要删除吗？";dialog.confirm(d,a,"删除","transmission.removeTorrentsAndData",b)}else{var d="删除所选的 "+b.length+" 个种子以及它们的数据？",a="这个种子下载的所有数据将被删除，你确定要删除吗？";dialog.confirm(d,a,"删除","transmission.removeTorrentsAndData",b)}},removeTorrents:function(b){var a=this.getTorrentIds(b);this.remote.removeTorrents(a,this.refreshTorrents,this)},removeTorrentsAndData:function(a){this.remote.removeTorrentsAndData(a)},verifySelectedTorrents:function(){this.verifyTorrents(this.getSelectedTorrents())},reannounceSelectedTorrents:function(){this.reannounceTorrents(this.getSelectedTorrents())},startAllTorrents:function(a){this.startTorrents(this.getAllTorrents(),a)},startSelectedTorrents:function(a){this.startTorrents(this.getSelectedTorrents(),a)},startTorrent:function(a){this.startTorrents([a],false)},startTorrents:function(a,b){this.remote.startTorrents(this.getTorrentIds(a),b,this.refreshTorrents,this)},verifyTorrent:function(a){this.verifyTorrents([a])},verifyTorrents:function(a){this.remote.verifyTorrents(this.getTorrentIds(a),this.refreshTorrents,this)},reannounceTorrent:function(a){this.reannounceTorrents([a])},reannounceTorrents:function(a){this.remote.reannounceTorrents(this.getTorrentIds(a),this.refreshTorrents,this)},stopAllTorrents:function(){this.stopTorrents(this.getAllTorrents())},stopSelectedTorrents:function(){this.stopTorrents(this.getSelectedTorrents())},stopTorrent:function(a){this.stopTorrents([a])},stopTorrents:function(a){this.remote.stopTorrents(this.getTorrentIds(a),this.refreshTorrents,this)},changeFileCommand:function(b,a,c){this.remote.changeFileCommand(b,a,c)},hideMobileAddressbar:function(a){if(isMobileDevice&&!scroll_timeout){var c=$.proxy(this.doToolbarHide,this),b=a*1000||150;scroll_timeout=setTimeout(c,b)}},doToolbarHide:function(){window.scrollTo(0,1);scroll_timeout=null},moveTop:function(){this.remote.moveTorrentsToTop(this.getSelectedTorrentIds(),this.refreshTorrents,this)},moveUp:function(){this.remote.moveTorrentsUp(this.getSelectedTorrentIds(),this.refreshTorrents,this)},moveDown:function(){this.remote.moveTorrentsDown(this.getSelectedTorrentIds(),this.refreshTorrents,this)},moveBottom:function(){this.remote.moveTorrentsToBottom(this.getSelectedTorrentIds(),this.refreshTorrents,this)},updateGuiFromSession:function(j){var d,f,g,a,i,c=Transmission.fmt,h=$("#settings_menu");this.serverVersion=j.version;this.prefsDialog.set(j);if(RPC._TurtleState in j){a=j[RPC._TurtleState];g=$("#turtle-button");i=["点击 ",(a?"关闭":"打开")," 临时限速 (",c.speed(j[RPC._TurtleUpSpeedLimit])," 上传,",c.speed(j[RPC._TurtleDownSpeedLimit])," 下载)"].join("");g.toggleClass("selected",a);g.attr("title",i)}if(this.isMenuEnabled&&(RPC._DownSpeedLimited in j)&&(RPC._DownSpeedLimit in j)){d=j[RPC._DownSpeedLimit];f=j[RPC._DownSpeedLimited];g=h.find("#limited_download_rate");g.html("限速 ("+c.speed(d)+")");if(!f){g=h.find("#unlimited_download_rate")}g.deselectMenuSiblings().selectMenuItem()}if(this.isMenuEnabled&&(RPC._UpSpeedLimited in j)&&(RPC._UpSpeedLimit in j)){d=j[RPC._UpSpeedLimit];f=j[RPC._UpSpeedLimited];g=h.find("#limited_upload_rate");g.html("限速 ("+c.speed(d)+")");if(!f){g=h.find("#unlimited_upload_rate")}g.deselectMenuSiblings().selectMenuItem()}},updateStatusbar:function(){var b=0,h=0,c,g,f,a=Transmission.fmt,e=this.getAllTorrents();for(c=0;g=e[c];++c){b+=g.getUploadSpeed();h+=g.getDownloadSpeed()}$("#speed-up-container").toggleClass("active",b>0);$("#speed-up-label").text(a.speedBps(b));$("#speed-dn-container").toggleClass("active",h>0);$("#speed-dn-label").text(a.speedBps(h));$("#filter-count").text(a.countString("个任务","个任务",this._rows.length))},setEnabled:function(b,a){$(b).toggleClass("disabled",!a)},updateFilterSelect:function(){var b,d,a,g,f,c=$("#filter-tracker"),h=this.getTrackers();d=[];for(a in h){d.push(a)}d.sort();if(!this.filterTracker){g='<option value="all" selected="selected">所有</option>'}else{g='<option value="all">所有</option>'}for(b=0;a=d[b];++b){f=h[a];g+='<option value="'+f.domain+'"';if(h[a].domain===this.filterTracker){g+=' selected="selected"'}g+=">"+a+"</option>"}if(!this.filterTrackersStr||(this.filterTrackersStr!==g)){this.filterTrackersStr=g;$("#filter-tracker").html(g)}},updateButtonsSoon:function(){if(!this.buttonRefreshTimer){var b=$.proxy(this.updateButtonStates,this),a=100;this.buttonRefreshTimer=setTimeout(b,a)}},updateButtonStates:function(){var g=this.elements,j=false,c=false,k=false,f=false,h=false;clearTimeout(this.buttonRefreshTimer);delete this.buttonRefreshTimer;for(var d=0,l;l=this._rows[d];++d){var b=l.getTorrent().isStopped();var a=l.isSelected();if(!b){j=true}if(b){c=true}if(a){k=true}if(a&&!b){f=true}if(a&&b){h=true}}this.setEnabled(g.toolbar_pause_button,f);this.setEnabled(g.toolbar_start_button,h);this.setEnabled(g.toolbar_remove_button,k)},inspectorIsVisible:function(){return $("#torrent_inspector").is(":visible")},toggleInspector:function(){this.setInspectorVisible(!this.inspectorIsVisible())},setInspectorVisible:function(b){if(b){this.inspector.setTorrents(this.getSelectedTorrents())}$("#torrent_inspector").toggle(b);$("#toolbar-inspector").toggleClass("selected",b);this.hideMobileAddressbar();if(isMobileDevice){$("body").toggleClass("inspector_showing",b)}else{var a=b?$("#torrent_inspector").outerWidth()+1+"px":"0px";$("#torrent_container")[0].style.right=a}},refilterSoon:function(){if(!this.refilterTimer){var a=this,c=function(){a.refilter(false)},b=100;this.refilterTimer=setTimeout(c,b)}},sortRows:function(e){var b,d,f,a={},c=[];for(b=0;f=e[b];++b){d=f.getTorrent();c.push(d);a[d.getId()]=f}Torrent.sortTorrents(c,this[Prefs._SortMethod],this[Prefs._SortDirection]);for(b=0;d=c[b];++b){e[b]=a[d.getId()]}},refilter:function(k){var s,y,n,m,g,A,h,r,v,b,w=this[Prefs._SortMethod],C=this[Prefs._SortDirection],f=this[Prefs._FilterMode],d=this.filterText,B=this.filterTracker,q=this.torrentRenderer,x=this.elements.torrent_list,a=$(x).children(".selected").length;this.updateFilterSelect();clearTimeout(this.refilterTimer);delete this.refilterTimer;if(k){$(x).empty();this._rows=[];for(n in this._torrents){this.dirtyTorrents[n]=true}}r=[];v=[];for(s=0;g=this._rows[s];++s){if(g.getTorrentId() in this.dirtyTorrents){v.push(g)}else{r.push(g)}}y=[];for(s=0;g=v[s];++s){y.push(g.getElement())}$(y).detach();A=[];for(s=0;g=v[s];++s){n=g.getTorrentId();m=this._torrents[n];if(m&&m.test(f,d,B)){A.push(g)}delete this.dirtyTorrents[n]}v=A;for(n in this.dirtyTorrents){m=this._torrents[n];if(m&&m.test(f,d,B)){g=new TorrentRow(q,this,m);y=g.getElement();y.row=g;v.push(g);$(y).click($.proxy(this.onRowClicked,this));$(y).dblclick($.proxy(this.toggleInspector,this))}}this.sortRows(v);h=[];var j=0,l=r.length;var u=0,p=v.length;b=document.createDocumentFragment();while(j!=l||u!=p){var o;if(j==l){o=false}else{if(u==p){o=true}else{var z=Torrent.compareTorrents(r[j].getTorrent(),v[u].getTorrent(),w,C);o=(z<0)}}if(o){h.push(r[j++])}else{g=v[u++];y=g.getElement();if(j!==l){x.insertBefore(y,r[j].getElement())}else{b.appendChild(y)}h.push(g)}}x.appendChild(b);this._rows=h;this.dirtyTorrents={};y=[];for(s=0;g=h[s];++s){y.push(g.getElement())}$(y).filter(":odd").addClass("even");$(y).filter(":even").removeClass("even");this.updateStatusbar();if(a!==$(x).children(".selected").length){this.selectionChanged()}},setFilterMode:function(a){this.setPref(Prefs._FilterMode,a);this.refilter(true)},onFilterModeClicked:function(a){this.setFilterMode($("#filter-mode").val())},onFilterTrackerClicked:function(b){var a=$("#filter-tracker").val();this.setFilterTracker(a==="all"?null:a)},setFilterTracker:function(b){var a=b?this.getReadableDomain(b):"all",c="#show-tracker-"+a;$(c).addClass("selected").siblings().removeClass("selected");this.filterTracker=b;this.refilter(true)},getDomainName:function(b){var a=b.indexOf(".");if(a!==b.lastIndexOf(".")){b=b.slice(a+1)}return b},getReadableDomain:function(b){if(b.length){b=b.charAt(0).toUpperCase()+b.slice(1)}var a=b.indexOf(".");if(a!==-1){b=b.slice(0,a)}return b},getTrackers:function(){var f={};var g=this.getAllTorrents();for(var d=0,m;m=g[d];++d){var h=[];var e=m.getTrackers();for(var c=0,k;k=e[c];++c){var b,l=k.announce;if(l in this.uriCache){b=this.uriCache[l]}else{b=this.uriCache[l]=parseUri(l);b.domain=this.getDomainName(b.host);b.name=this.getReadableDomain(b.domain)}if(!(b.name in f)){f[b.name]={uri:b,domain:b.domain,count:0}}if(h.indexOf(b.name)===-1){h.push(b.name)}}for(var c=0,a;a=h[c];++c){f[a].count++}}return f},toggleCompactClicked:function(){this.setCompactMode(!this[Prefs._CompactDisplayState])},setCompactMode:function(a){var c=Prefs._CompactDisplayState,b=this[c];if(b!==a){this.setPref(c,a);this.onCompactModeChanged()}},initCompactMode:function(){this.onCompactModeChanged()},onCompactModeChanged:function(){var a=this[Prefs._CompactDisplayState];$("#compact-button").toggleClass("selected",a);this.torrentRenderer=a?new TorrentRendererCompact():new TorrentRendererFull();this.refilter(true)},togglePeriodicStatsRefresh:function(a){clearInterval(this.statsInterval);delete this.statsInterval;if(a){var c=$.proxy(this.loadDaemonStats,this),b=5000;this.statsInterval=setInterval(c,b)}},loadDaemonStats:function(a){this.remote.loadDaemonStats(function(b){this.updateStats(b["arguments"])},this,a)},updateStats:function(b){var d,c,a=Transmission.fmt;d=b["current-stats"];c=Math.ratio(d.uploadedBytes,d.downloadedBytes);$("#stats-session-uploaded").html(a.size(d.uploadedBytes));$("#stats-session-downloaded").html(a.size(d.downloadedBytes));$("#stats-session-ratio").html(a.ratioString(c));$("#stats-session-duration").html(a.timeInterval(d.secondsActive));d=b["cumulative-stats"];c=Math.ratio(d.uploadedBytes,d.downloadedBytes);$("#stats-total-count").html(d.sessionCount+"次");$("#stats-total-uploaded").html(a.size(d.uploadedBytes));$("#stats-total-downloaded").html(a.size(d.downloadedBytes));$("#stats-total-ratio").html(a.ratioString(c));$("#stats-total-duration").html(a.timeInterval(d.secondsActive))},showStatsDialog:function(){this.loadDaemonStats();this.hideMobileAddressbar();this.togglePeriodicStatsRefresh(true);$("#stats-dialog").dialog({close:$.proxy(this.onStatsDialogClosed,this),show:"fade",hide:"fade",title:"统计信息"})},onStatsDialogClosed:function(){this.hideMobileAddressbar();this.togglePeriodicStatsRefresh(false)}};